define(["backbone","text!tpl/AccountSettings.html","text!tpl/SuccessfulUserFeedback.html","models/user-model"],function(e,t,n,r){var i=e.View.extend({tagName:"div",className:"view_account_settings_details",template:_.template(t),events:{"keypress #new_password_1":"new_password_1","keypress #new_password_2":"new_password_2","keypress #first_name":"first_name","keypress #last_name":"last_name","keypress #email_address":"email_address","keypress #phone_number":"phone_number","blur #new_password_1":"new_password_1_blur","blur #new_password_2":"new_password_2_blur","blur #first_name":"first_name_blur","blur #last_name":"last_name_blur","blur #email_address":"email_address_blur","blur #phone_number":"phone_number_blur","click #submit_new_password":"submit_new_password","click #submit_new_user_details":"update_user_details","mouseover #submit_new_user_details":"select_proceed","mouseout #submit_new_user_details":"deselect_proceed","mouseover #submit_new_password":"select_proceed","mouseout #submit_new_password":"deselect_proceed"},select_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#1D883B")},deselect_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#2BBB53")},initialize:function(){console.log("in initialize() of account-settings-view.js"),this.current_view=this,this.ENTER_KEY=13;if(!this.user){this.user=new r,console.log("this.model.id: "+this.model.id);var e={};e._id=this.model.attributes._id,e.first_name=this.model.attributes.first_name,e.last_name=this.model.attributes.last_name,e.email_address=this.model.attributes.email_address,e.phone_number=this.model.attributes.phone_number,e.braintree_customer_id=this.model.attributes.braintree_customer_id,this.user.set(e)}},render:function(){return console.log("in account-settings-view.js and render()"),console.log("this.model:"),console.log(this.model),this.$el.html(this.template(this.model.toJSON())),this.$first_name=this.$("#first_name"),this.$last_name=this.$("#last_name"),this.$email_address=this.$("#email_address"),this.$phone_number=this.$("#phone_number"),this.$new_password_1=this.$("#new_password_1"),this.$new_password_2=this.$("#new_password_2"),this.user_entered_data={},this},new_password_1:function(e){console.log("new_password_1")},new_password_2:function(e){console.log("new_password_2"),e.which===this.ENTER_KEY&&(this.$new_password_2.blur(),this.submit_new_password())},first_name:function(e){console.log("first_name"),e.which===this.ENTER_KEY&&(console.log("first_name ENTER KEY HIT"),this.$first_name.blur(),this.update_user_details())},last_name:function(e){console.log("last_name"),e.which===this.ENTER_KEY&&(this.$last_name.blur(),this.update_user_details())},email_address:function(e){console.log("email_address"),e.which===this.ENTER_KEY&&(this.$email_address.blur(),this.update_user_details())},phone_number:function(e){console.log("phone_number"),e.which===this.ENTER_KEY&&(this.$phone_number.blur(),this.update_user_details())},new_password_1_blur:function(){this.close_input_field(this.$new_password_1,"new_password_1")},new_password_2_blur:function(){this.close_input_field(this.$new_password_2,"new_password_2")},first_name_blur:function(){console.log("first_name_blur function "),this.change_user_model_attribute(this.$first_name,"first_name")},last_name_blur:function(){console.log("last_name_blur function "),this.change_user_model_attribute(this.$last_name,"last_name")},email_address_blur:function(){console.log("email_address_blur function "),this.change_user_model_attribute(this.$email_address,"email_address")},phone_number_blur:function(){console.log("phone_number_blur function "),this.change_user_model_attribute(this.$phone_number,"phone_number")},change_user_model_attribute:function(e,t){var n=e.val().trim();this.user.set(t,n)},update_user_details:function(){console.log("*** UPDATING SETTINGS ***");var e=this;this.user.save({},{success:function(t,r,i){console.log("SUCCESS: updated user settings!!!"),console.dir(t),console.log(r),console.log(i);var s=e.$("#change_user_details > .successful_user_feedback");s.css("display")=="block"&&s.css("display","none");if(r.errors){if(!_.isEmpty(r.errors.validation_errors)){console.log("VALIDATION ERRORS");for(var o in r.errors.validation_errors){var u="#"+r.errors.validation_errors[o].param;console.log(u),$(u).parent(".form-group").addClass("has-error")}return}if(!_.isEmpty(r.errors.internal_errors)){console.log("INTERNAL ERRORS"),e.render(),e.$("#change_user_details input").addClass("has-error");return}if(!_.isEmpty(r.errors.braintree_errors)){console.log("BRAINTREE ERRORS: "+r.errors.braintree_errors.error),e.render(),e.$("#change_user_details input").addClass("has-error");return}}_.isEmpty(t)||(console.log(e.model),e.model=t,e.render(),e.$("#change_user_details").prepend(_.template(n)({success:"Updated your settings"})))},error:function(t,n,r){console.log("ERROR: could not update user settings!!!"),console.dir(t),console.log(n),console.log(r),e.$("#change_user_details input").addClass("has-error")}})},close_input_field:function(e,t){var n=e.val().trim();this.user_entered_data[t]=n},submit_new_password:function(){console.log("in submit_new_password"),console.log("this.user_entered_data object: "),console.log(this.user_entered_data);var e=this;$.ajax({url:"/api/users/change_password/",type:"POST",data:e.user_entered_data,success:function(t,r,i){console.log("AJAX SUCCESS: posted the change password data"),console.dir(t),console.log(r),console.dir(i);var s=e.$(".form-group");s.hasClass("has-error")&&s.removeClass("has-error");var o=e.$("#change_password > .successful_user_feedback");o.css("display")=="block"&&o.css("display","none"),t.success&&(console.log("SUCCESS: password has been reset"),e.render(),e.$("#change_password").prepend(_.template(n)({success:"Updated your password"})));if(!_.isEmpty(t.errors.validation_errors)){console.log("VALIDATION ERRORS");for(var u in t.errors.validation_errors){var a="#"+t.errors.validation_errors[u].param;console.log(a),$(a).parent(".form-group").addClass("has-error")}}_.isEmpty(t.errors.internal_errors)||(t.errors.internal_errors.error==="passwords_do_not_match"?console.log("INTERNAL ERRORS: passwords dont match"):console.log("INTERNAL ERRORS: generic internal error"),e.$("#new_password_1").parent(".form-group").addClass("has-error"),e.$("#new_password_2").parent(".form-group").addClass("has-error"))},error:function(t,n,r){console.log("AJAX ERROR: in postin the change password data"),console.dir(t),console.log(n),console.dir(errorThrown),e.$("#new_password_1").parent(".form-group").addClass("has-error"),e.$("#new_password_2").parent(".form-group").addClass("has-error")}})},show_view:function(e,t){return console.log("in show_view()"),this.current_view&&this.current_view.close(),$(e).html(t.render().el),this.current_view=t,t}});return i});