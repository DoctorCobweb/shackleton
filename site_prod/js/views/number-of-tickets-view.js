define(["backbone","text!tpl/NumberOfTicketsView.html","models/order-model","collections/ordersCollection","views/credit-card-details-view","views/checkout-view","views/purchase-with-credit-card-from-vault-view","text!tpl/NegativeUserFeedback.html"],function(e,t,n,r,i,s,o,u){var a=e.View.extend({tagName:"div",className:"view_number_of_tickets",template:_.template(t),events:{"click #ticket_amount_one":"one_ticket","click #ticket_amount_two":"two_tickets","click #ticket_amount_three":"three_tickets","click #ticket_amount_four":"four_tickets","click #ticket_amount_five":"five_tickets","click #ticket_amount_six":"six_tickets","click #ticket_amount_seven":"seven_tickets","click #ticket_amount_eight":"eight_tickets","click #submit":"submit","mouseover .ticket_select":"select_ticket","mouseout .ticket_select":"deselect_ticket","mouseover .proceed":"select_proceed","mouseout .proceed":"deselect_proceed"},select_ticket:function(e){this.$("#"+e.currentTarget.id).css("background-color","#AAB61D")},deselect_ticket:function(e){this.$("#"+e.currentTarget.id).css("background-color","#efff33")},select_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#1D883B")},deselect_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#2BBB53")},initialize:function(){console.log("in initialize() of number-of-tickets-view.js"),this.current_view=this,this.BT_DEFAULT_CUS="default_braintree_customer_id",_.bindAll(this),this.number_of_tickets=0,this.total_amount=0,this.tmp_model={},console.log("this.options");for(var e in this.options)console.log(this.options[e])},render:function(){return console.log("in number-of-tickets-view.js and render()"),this.$el.html(this.template(this.model.toJSON())),this},one_ticket:function(){this.number_of_tickets=1,this.calculate_total_and_display()},two_tickets:function(){this.number_of_tickets=2,this.calculate_total_and_display()},three_tickets:function(){this.number_of_tickets=3,this.calculate_total_and_display()},four_tickets:function(){this.number_of_tickets=4,this.calculate_total_and_display()},five_tickets:function(){this.number_of_tickets=5,this.calculate_total_and_display()},six_tickets:function(){this.number_of_tickets=6,this.calculate_total_and_display()},seven_tickets:function(){this.number_of_tickets=7,this.calculate_total_and_display()},eight_tickets:function(){this.number_of_tickets=8,this.calculate_total_and_display()},calculate_total_and_display:function(){this.total_amount=this.number_of_tickets*this.model.get("price"),this.model.set({number_of_tickets:self.number_of_tickets}),console.log("Total price for "+this.number_of_tickets+" is: "+this.total_amount),this.$("#total_amount").html(this.total_amount);return},submit:function(){console.log("clicked proceed to payment button");var t=this;if(!t.number_of_tickets){console.log("ERROR: no tickets have been selected"),this.$("#number_of_tickets").prepend(_.template(u)({error:"No tickets selected"}));return}this.new_order||(this.new_order=new n),this.new_order.set({gig_id:t.model.get("_id"),ticket_price:t.model.get("price"),number_of_tickets:t.number_of_tickets,transaction_amount:t.total_amount}),this.orders_collection||(this.orders_collection=new r),this.orders_collection.add(this.new_order),this.new_order.save({},{success:function(n,r){console.log("SUCCESS: saved the new_order for the first time."),console.dir(n),console.dir(r);if(r.success===!1){if(!_.isEmpty(r.errors.validation_errors)){console.log("VALIDATION_ERRORS:"),alert("VALIDATION_ERRORS"),console.dir(r.errors.validation_errors);for(var s in r.errors.validation_errors)console.log("validation_errors["+s+"]: "+r.errors.validation_errors[s]);return}if(!_.isEmpty(r.errors.internal_errors)){console.log("INTERNAL_ERRORS:"),alert("INTERNAL_ERRORS: try again");for(var s in r.errors.internal_errors)console.log("internal_errors["+s+"]: "+r.errors.internal_errors[s]);return}}else{console.log("CUSTOM_EVENT(order:start, trigger)"),console.log("CUSTOM_EVENT(order:start, trigger), parameter: "+r._id),e.trigger("order:start",r._id);if(r.braintree_customer_id===t.BT_DEFAULT_CUS){console.log("SUCCESSful order creation, FIRST TIME PURCHASER."),console.log("self.new_order:"),console.dir(t.new_order),console.log("model:"),console.dir(n);var u=new i({model:t.new_order});t.show_view("#featureContent",u),window.scrollTo(0,350)}else if(r.braintree_customer_id!==t.BT_DEFAULT_CUS){console.log("SUCCESSful order creation, RETURNING PURCHASER."),console.log("self.new_order:"),console.dir(t.new_order),console.log("model:"),console.dir(n);var a=new o({model:t.new_order});t.show_view("#featureContent",a),window.scrollTo(0,350)}}},error:function(e,t){console.log("ERROR: could not save the new_order for the first time."),console.dir(e),console.dir(t),alert("ERROR: ajax callback: could not save the new_order model.")}})},show_view:function(e,t){return console.log("in showView of number-of-tickets-view.js"),this.current_view&&this.current_view.close(),$(e).html(t.render().el),this.current_view=t,t}});return a});