define(["backbone","text!tpl/GigDetails.html","./number-of-tickets-view","models/order-model","collections/ordersCollection","views/login-with-gig-details-view","cookie_util"],function(e,t,n,r,i,s,o){var u=e.View.extend({tagName:"div",className:"gigDetails",template:_.template(t),events:{"click #get_tickets":"get_tickets","mouseover #get_tickets":"select_proceed","mouseout #get_tickets":"deselect_proceed"},select_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#1D883B")},deselect_proceed:function(e){this.$("#"+e.currentTarget.id).css("background-color","#2BBB53")},initialize:function(){console.log("in initialize() of gig-detail-view.js"),this.current_view=this,this.old_reserve_tickets_cookie=o.get("reserve_tickets");if(this.old_reserve_tickets_cookie){var e=this.old_reserve_tickets_cookie.indexOf("{"),t=this.old_reserve_tickets_cookie.indexOf("}");console.log("left_brace = "+e+" right_brace = "+t);var n='order_id":"';console.log("the_order.length = "+n.length);var r=this.old_reserve_tickets_cookie.indexOf(n);console.log(this.old_reserve_tickets_cookie.substring(r,t+1));var i=r+n.length;console.log("order_value_start: "+i),this.the_old_order_id=this.old_reserve_tickets_cookie.substring(i,t-1),console.log("this.the_old_order_id: "+this.the_old_order_id)}console.log("this.options: ");for(var s in this.options)console.log(this.options[s])},render:function(){return console.log("in gig-detail-view.js and render()"),this.$el.html(this.template(this.model.toJSON())),console.log("this.model: "),console.dir(this.model),this},get_tickets:function(){console.log("in get_tickets click handler.");var t=this;t.old_reserve_tickets_cookie&&e.trigger("order:stop_polling"),$.ajax({url:"/api/users/session",type:"GET",success:function(e,r,i){console.log("SUCCESS: got $.ajax GET /api/users/session"),console.dir(e),console.log("textStatus: "+r),console.dir(i);if(!e.user_authenticated){var o=new s({model:t.model});t.show_view("#featureContent",o)}else if(e.user_authenticated===!0)if(t.old_reserve_tickets_cookie)console.log("there is an OLD reserve_tickets cookie, value: "),console.log("...deleting by phoning home..."),t.reserve_tickets_release();else{var u=new n({model:t.model});t.show_view("#featureContent",u),window.scrollTo(0,350)}},error:function(e,t,n){console.log("ERROR: tried to $.ajax GET /api/users/session"),console.dir(e),console.log("textStatus: "+t),console.log("errorThrown: "+n),alert("Internal Error: try again")}})},reserve_tickets_release:function(){var e=this;console.log("checking for reserve_tickets cookie presence...");var t={the_cookie:"reserve_tickets",reserved_order_id:e.the_old_order_id};$.ajax({url:"/api/orders/give_up_reserved_tickets",type:"POST",data:t,success:function(t,r,i){console.log("SUCCESS: released tickets due to navigating away"),console.dir(t),console.log("textStatus: "+r),console.dir(i);if(t.success===!1){if(!_.isEmpty(t.errors.validation_errors)){console.log("VALIDATION_ERRORS: we have validation errors"),alert("Please try again"),e.render();return}if(!_.isEmpty(t.errors.internal_errors)){console.log("INTERNAL_ERRORS: we have internal errors"),alert("Please try again"),e.render();return}}else{console.log("SUCCESSFUL release of reserved tix. go onto to next view");var s=new n({model:e.model});e.show_view("#featureContent",s),window.scrollTo(0,350)}},error:function(e,t,n){console.log("ERROR: in releasing tickets dut to navigating away"),console.dir(e),console.log("textStatus: "+t),console.dir(n),alert("Internal error: please try again")}})},show_view:function(e,t){return console.log("in showView in gig-detail-view.js"),this.current_view&&this.current_view.close(),$(e).html(t.render().el),this.current_view=t,t}});return u});