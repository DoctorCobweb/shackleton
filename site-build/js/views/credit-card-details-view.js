define(["backbone","braintree","text!tpl/CreditCardDetailsView.html","views/checkout-view"],function(e,t,n,r){var i=e.View.extend({tagName:"div",className:"credit_card_details",template:_.template(n),events:{"keypress #cc_number":"cc_number_update","keypress #cc_cvv":"cc_cvv_update","keypress #cc_month":"cc_month_update","keypress #cc_year":"cc_year_update","blur #cc_number":"cc_number_blur","blur #cc_cvv":"cc_cvv_blur","blur #cc_month":"cc_month_blur","blur #cc_year":"cc_year_blur","click #submit":"submit"},initialize:function(){console.log("in initialize() of credit-card-details-view.js"),this.current_view=this,_.bindAll(this),this.braintree=t.create("MIIBCgKCAQEAwJo0HGLwcnHbj+LCBWEvxjjfZYTwoJuNvR34CevWwu71HeQ7s6kD9FuzK3nHFL0oA2/HchnhmWh4ilFzYq3/4U+hNLJwdG++MlZxQ9KlfLX2ROatmuOyIcD1mXKlKAEhuxU4OnTBnMByyzhy3Hz/9omOGWK0bjmSKkZabjwiqgs0E2VLeRaTERxWPPAKEPgKfiFjiYdOyYbXvvOtRU6kMze6ZoYnF098/RkrJuL8a+tn6otmQHJOvvLobJf0PYTH1YKEgx7JGhTQ0tvewd/gz4Lg8GMknM0HkGWaqtpLzeqahDGfik0PZQfWArvVQofOLVito0yY1Ck6G2A8mrjb/QIDAQAB"),console.log("braintree object:"),console.dir(this.braintree),this.start_reserve_tickets_countdown()},render:function(){console.log("in credit-card-details-view.js and render()"),this.$el.html(this.template(this.model.toJSON()));var e=this.model.get("number_of_tickets")*this.model.get("ticket_price");return this.$("#summary_total_amount").html(e),this.$cc_number=this.$("#cc_number"),this.$cc_cvv=this.$("#cc_cvv"),this.$cc_month=this.$("#cc_month"),this.$cc_year=this.$("#cc_year"),this},cc_number_update:function(e){console.log("cc_number");return},cc_cvv_update:function(e){console.log("cc_cvv");return},cc_month_update:function(e){console.log("cc_month");return},cc_year_update:function(e){console.log("cc_year");return},cc_number_blur:function(e){console.log("cc_number_blur"),this.close_input_field(this.$cc_number,"cc_number");return},cc_cvv_blur:function(e){console.log("cc_cvv_blur"),this.close_input_field(this.$cc_cvv,"cc_cvv");return},cc_month_blur:function(e){console.log("cc_month_blur"),this.close_input_field(this.$cc_month,"cc_month");return},cc_year_blur:function(e){console.log("cc_year_blur"),this.close_input_field(this.$cc_year,"cc_year");return},close_input_field:function(e,t){console.log("close_input_field()"),console.dir(e),console.log("model_attribute: "+t);var n={},r=e.val().trim(),i=this.braintree.encrypt(r);n[t]=i,this.model.set(n),console.log("value entered into field, "+t+" is "+r),console.log("encrpyted value of entered into field, "+t+" is "+i);return},submit:function(e){console.log("submitting cc details"),console.log("this.model: "),console.dir(this.model);var t=this;this.model.save({},{error:function(e,t){console.log("ERROR in saving/updating the model"),console.dir(e),console.dir(t)},success:function(e,n){console.log("SUCCESS in saving/updating the model"),console.dir(e),console.dir(n),t.handle_cc_statuses(n,e)}})},handle_cc_statuses:function(e,t){var n=e.transaction_status;if(n==="submitted_for_settlement"){console.log("transaction_status: "+n),clearInterval(this.interval_id);var i=new r({model:t});this.show_view("#featureContent",i)}else n==="authorized"?console.log("transaction_status: "+n):console.log("transaction_status: "+n)},start_reserve_tickets_countdown:function(){console.log("in start_reserve_tickets_coundown()"),this.poll=0,this.interval_id=setInterval(this.poller,1e3)},parse_cookie_string:function(){this.cookies_obj={},this.cookies_array=document.cookie.split(";");for(var e in this.cookies_array){var t=this.cookies_array[e].substring(0,this.cookies_array[e].indexOf("=")),n=this.cookies_array[e].substring(this.cookies_array[e].indexOf("=")+1);t=t.replace(/^\s+|\s+$/g,""),this.cookies_obj[t]=n}},poller:function(){this.parse_cookie_string();if(this.cookies_obj.reserve_tickets)this.poll++,this.$("#ticker").html(this.poll);else{console.log("ALONGSIDE YOUR HORSE, YOUR TICKET RESERVATION BOLTED OUT THE GATE."),clearInterval(this.interval_id);var e=this;$.ajax({url:"/api/orders/ticket_reserve_timeout",type:"POST",data:this.model.toJSON(),success:function(e,t,n){console.log("SUCCESS: deleted ticket reserve cookie"),console.dir(e),console.log(t),console.dir(n)},error:function(e,t,n){console.log("ERROR: trouble with deleting ticket reserve cookie"),console.dir(e),console.log(t),console.dir(n)}})}},show_view:function(e,t){return console.log("in showView of credit-card-details-view.js"),this.current_view&&this.current_view.close(),$(e).html(t.render().el),this.current_view=t,t}});return i});